<!DOCTYPE html>
<html style="font-size: 14px">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title></title>
    <script src="../lib/index.js"></script>
    <script>
      RegExp.prototype.execAll = function (str) {
        let map = {};
        let result = null;
        do {
          result = this.exec(str);
          if (result) map[result[1]] = result[2];
        } while (this.lastIndex != 0);
        return map;
      };
      location.getSearch=function (url) {
        if (!url) url = location.href;
        let search = /([^&?#]+)=([^&?#]+)/g.execAll(url);
        for (let key in search) {
          if (Object.prototype.hasOwnProperty.call(search, key)) {
            search[key] = window.encodeURIComponent(search[key]);
          }
        }
        return search;
      };
    </script>
    <style>
      button{
        border:1px solid black;
        padding:20px;
      }
      #log{
        margin:10px;
        padding:10px;
        font-size:14px;
        border:1px solid black;
      }
    </style>
  </head>
  <body>
    <button id="btnOk">设置分享文案</button>
    <div id="log"></div>
    <script>
      

      window.onload = () => {
        var wechatHelper =  window['wechat-helper'].default || window['wechat-helper'];
        var helper = new wechatHelper({
          wxid:'testcalm',
          appId:'wx054de4175bc8fdc2'
        });

        document.querySelector('#btnOk').onclick = () => {
          
          helper.setShare({
            title:'分享文案设置',
            desc:'详情内容设置',
            imgUrl:`${location.protocol}//${location.hostname}/review/wechat-helper/public/test/share.jpg`,
            link:location.href,
            success:()=>{
              var log = document.querySelector('#log');
              var html = log.innerHTML;
              html += '<br/>设置完成'
              log.innerHTML = html;
            }
          });

          return;
          // let saveName = 'wx_wx054de4175bc8fdc2';
          // let req = location.getSearch();
          // let wxInfo = localStorage.getItem(saveName);
          // if(wxInfo){
          //   wxInfo=JSON.parse(wxInfo);
          // }
          // if(wxInfo&&wxInfo.userInfo){
          //   location.replace(req.redirect);
          //   return;
          // }
          // var helper = new window.WechatHelper.default({ appId: 'wx054de4175bc8fdc2' });
          // var temp = helper.needAuth(true);
          // if(temp.needAuth){
          //   location.replace(temp.url);
          // }else{
          //   axios.get(`https://m.vuedata.cn/ndapp/wx/getUserInfo`,{
          //     params:{
          //       wxid:'testcalm',
          //       code:temp.code
          //     }
          //   }).then((ret)=>{
          //     debugger;
          //     let userInfo = ret.data;
          //     localStorage.setItem(saveName,JSON.stringify({userInfo:userInfo}));
          //     if(req.redirect){
          //       location.replace(decodeURIComponent(req.redirect));
          //     }
          //   })
          // }
        
        };
      };
    </script>
  </body>
</html>
